<html>
<head>
  <style>
    input {
      font-family: monospace;
      text-align: right;
    }
  </style>
  <script src="http://localhost:35729/livereload.js?snipver=1"></script>
  <script src="node_modules/chai/chai.js"></script>
  <script src="node_modules/mocha/mocha.js"></script>
  <link  href="node_modules/mocha/mocha.css" rel="stylesheet" />
</head>
<body>
<div id="mocha"></div>
<input id="num" type="text" value="1234567"/> -> <input id="num_out" type="text" readonly disabled/>
<script>
  function reverse(string) {
    return string.split("").reverse().join("");
  }
  function format(value) {
    return value.length === 0
        ? ""
        : reverse(reverse(value.replace(/,/g, "")).match(/.{1,3}/g).join(thousandSeparator));
  }
  function inject(string, character, positionFromLeft) {
    return (string.slice(0, positionFromLeft) + character + string.slice(positionFromLeft));
  }
  function strip(string) {
    return string.replace(/[^0-9]/g, '');
  }

  const out = document.getElementById("num_out");
  const el = document.getElementById("num");
  const thousandSeparator = ",";

  el.value = format(el.value);
  out.value = strip(el.value);

  const listener = function(event) {
    const priorPosition = event.target.selectionStart;

    if (/[0-9]/.test(event.key)) {
      event.preventDefault();

      const value = event.target.value;
      event.target.value = format(inject(value, event.key, priorPosition));

      const shift = event.target.value.length - value.length;

      event.target.selectionStart = priorPosition + shift;
      event.target.selectionEnd = priorPosition + shift;
    }

    out.value = strip(event.target.value);
  };

  el.addEventListener("keydown", listener);
</script>
<script>
  mocha.setup('bdd');

  const assert = chai.assert;

  describe('mocha', function() {
    it('does assert with chai', function() {
      assert.isOk(true);
    });
  });

  mocha.run();
</script>
</body>
</html>
